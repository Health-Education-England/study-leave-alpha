{% extends "layout.html" %}

{% from 'button/macro.njk' import button %}
{% from 'task-list/macro.njk' import taskList %}

{% block pageTitle %}
  Future tudy leave serviSce - NHS England
{% endblock %}

{% block content %}

<style>
  .m-studyleave .nhsuk-table__panel-with-heading-tab{margin-top: 10px !important;}
</style>

<div class="nhsuk-grid-row">
  <div class="nhsuk-grid-column-two-thirds">
   <h1  style="margin-bottom: 0px;"  class="nhsuk-heading-l">Study leave report</h1>
   <p style="margin-top: 0px;">Keep track of study leave applications and expenses claims for your region.</p>
      <p>Budget period: <b>01 January 2025 </b>to <b>31 December 2025</b> <a href="#">Change</a></p>

       {{ button({
        text: "Download report"
       }) }}

  </div>

</div>





    {% from 'card/macro.njk' import card %}

<ul class="nhsuk-grid-row nhsuk-card-group">
  <li class="nhsuk-grid-column-one-quarter nhsuk-card-group__item">
    {{ card({
      clickable: "true",
      headingHtml: "<p class=\"nhsuk-heading-l nhsuk-u-font-size-48 nhsuk-u-margin-bottom-1\">328<span class=\"nhsuk-u-visually-hidden\">Applications submitted</span></p><span class=\"nhsuk-u-font-size-16\">Applications submitted</span>"
    }) }}
  </li>
  <li class="nhsuk-grid-column-one-quarter nhsuk-card-group__item">
    {{ card({
      clickable: "true",
      headingHtml: "<p class=\"nhsuk-heading-l nhsuk-u-font-size-48 nhsuk-u-margin-bottom-1\">281<span class=\"nhsuk-u-visually-hidden\">Applications approved</span></p><span class=\"nhsuk-u-font-size-16\">Applications approved</span>"
    }) }}
  </li>
  <li class="nhsuk-grid-column-one-quarter nhsuk-card-group__item">
    {{ card({
      clickable: "true",
      headingHtml: "<p class=\"nhsuk-heading-l nhsuk-u-font-size-48 nhsuk-u-margin-bottom-1\">£8999<span class=\"nhsuk-u-visually-hidden\">Expense requested</span></p><span class=\"nhsuk-u-font-size-16\">Expense <br>requested</span>"
    }) }}
  </li>
  <li class="nhsuk-grid-column-one-quarter nhsuk-card-group__item">
    {{ card({
      clickable: "true",
      headingHtml: "<p class=\"nhsuk-heading-l nhsuk-u-font-size-48 nhsuk-u-margin-bottom-1\">£1909 <span class=\"nhsuk-u-visually-hidden\">Expense approved</span></p><span class=\"nhsuk-u-font-size-16\">Expense <br>approved</span>"
    }) }}
  </li>
    

  


   
</ul>




  <style>
    :root{
      --track-bg:#e6e9ee;
      --fill-bg:#1f77b4;
      --danger:#d9534f;
      --radius:8px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      color:#0b1a2b;
    }
    .card{max-width:520px;margin-bottom:28px;padding:18px;background:#fff}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .label{font-size:14px;color:#22303f}
    .values{font-weight:600;font-size:18px}

    .progress-wrap{margin-top:14px}
    .progress-meta{display:flex;justify-content:space-between;align-items:center;font-size:13px;color:#54657a;margin-bottom:8px}

    .progress-track{width:100%;height:18px;background:var(--track-bg);border-radius:var(--radius);overflow:hidden;position:relative}
    .progress-fill{height:100%;width:0%;background:var(--fill-bg);border-radius:var(--radius);transition:width 800ms cubic-bezier(.2,.9,.3,1)}
    .progress-fill.over{background:var(--danger)}

    .percent-badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;background:#f1f6fb;color:#0b3a66;margin-left:8px}

    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    @media (max-width:420px){.values{font-size:16px}}
  </style>




    




    

  <script>
    (function(){
      // Values you can change dynamically or wire up to real data
      const approved = Number(document.getElementById('approvedAmt').textContent.replace(/[^0-9.]/g,''));
      const totalBudget = Number(document.getElementById('totalBudget').textContent.replace(/[^0-9.]/g,''));

      // guard against zero/NaN
      const safeTotal = Number.isFinite(totalBudget) && totalBudget > 0 ? totalBudget : 1;
      let pct = Math.round((approved / safeTotal) * 100);
      if (!Number.isFinite(pct)) pct = 0;
      const fill = document.getElementById('progressFill');
      const track = document.getElementById('progressTrack');
      const pctLabel = document.getElementById('percentLabel');
      const remainingText = document.getElementById('remainingText');
      const avgText = document.getElementById('avgText');

      // handle overrun (>100%) with visual clue
      if (pct > 100) {
        fill.classList.add('over');
      }

      // animate width (caps at 100 for visual fill; we still display actual pct badge)
      const visualPct = Math.min(Math.max(pct, 0), 100);
      requestAnimationFrame(() => { // give browser a tick before anim
        fill.style.width = visualPct + '%';
        track.setAttribute('aria-valuenow', Math.min(Math.max(pct,0),100));
      });

      // update labels
      pctLabel.textContent = pct + '%';
      const remaining = totalBudget - approved;
      remainingText.textContent = 'Remaining: £' + (remaining >= 0 ? remaining : 0);
      const approvals =  Math.max(1, 1); // placeholder: replace with real count if available
      avgText.textContent = 'Avg per approval: £' + (Math.round((approved / approvals) * 100) / 100);

      // optional: expose a small function for dynamically updating
      window.updateBudgetProgress = function(newApproved, newTotal, approvalsCount){
        const a = Number(newApproved);
        const t = Number(newTotal);
        const safeT = Number.isFinite(t) && t>0 ? t : 1;
        const newPct = Math.round((a/safeT)*100);
        fill.classList.toggle('over', newPct > 100);
        fill.style.width = Math.min(Math.max(newPct,0),100) + '%';
        pctLabel.textContent = newPct + '%';
        track.setAttribute('aria-valuenow', Math.min(Math.max(newPct,0),100));
        remainingText.textContent = 'Remaining: £' + Math.max(0, Math.round(t - a));
        avgText.textContent = 'Avg per approval: £' + (approvalsCount ? Math.round((a/approvalsCount)*100)/100 : '—');
        document.getElementById('approvedAmt').textContent = a;
        document.getElementById('totalBudget').textContent = t;
      };

    })();
  </script>









<hr class="nhsuk-u-margin-top-0">




<div class="nhsuk-grid-row">
  <div class="nhsuk-grid-column-two-thirds">
  
    <div class="nhsuk-grid-row">
    <section aria-labelledby="study-leave-chart-title">

  <h2 id="study-leave-chart-title">
    Monthly study leave applications and approvals
  </h2>

  <p id="study-leave-chart-summary">
    Applications peak in March and May. Approvals broadly follow the same trend,
    with a noticeable drop in July before recovering in August.
  </p>

  <!-- SVG CHART -->
  <figure aria-describedby="study-leave-chart-summary study-leave-chart-data" style="background-color: rgb(255, 255, 255);margin-left: 0;">
    <svg
      width="auto"
      height="auto"
      viewBox="0 0 700 400"
      role="img"
      aria-labelledby="chart-title chart-desc"
      tabindex="0"
    >
      <title id="chart-title">
        Study leave applications and approvals by month
      </title>
      <desc id="chart-desc">
        Line chart showing monthly study leave applications and approvals from January to December.
      </desc>

      <!-- Axes -->
      <line x1="60" y1="40" x2="60" y2="340" stroke="#6f777b" />
      <line x1="60" y1="340" x2="660" y2="340" stroke="#6f777b" />

      <!-- Y-axis label -->
      <text x="10" y="200" font-size="14" transform="rotate(-90 10,200)">
        Number of requests
      </text>

      <!-- X-axis labels -->
      <g font-size="12">
        <text x="90" y="360">Jan</text>
        <text x="140" y="360">Feb</text>
        <text x="190" y="360">Mar</text>
        <text x="240" y="360">Apr</text>
        <text x="290" y="360">May</text>
        <text x="340" y="360">Jun</text>
        <text x="390" y="360">Jul</text>
        <text x="440" y="360">Aug</text>
        <text x="490" y="360">Sep</text>
        <text x="540" y="360">Oct</text>
        <text x="590" y="360">Nov</text>
        <text x="640" y="360">Dec</text>
      </g>

      <!-- Applications line (solid + circles) -->
      <polyline
        fill="none"
        stroke="#005eb8"
        stroke-width="3"
        points="
          90,220 140,260 190,240 240,230 290,200 340,260
          390,300 440,220 490,250 540,280 590,240 640,250
        "
      />

      <!-- Applications markers -->
      <g fill="#005eb8">
        <circle cx="90" cy="220" r="4" />
        <circle cx="140" cy="260" r="4" />
        <circle cx="190" cy="240" r="4" />
        <circle cx="240" cy="230" r="4" />
        <circle cx="290" cy="200" r="4" />
        <circle cx="340" cy="260" r="4" />
        <circle cx="390" cy="300" r="4" />
        <circle cx="440" cy="220" r="4" />
        <circle cx="490" cy="250" r="4" />
        <circle cx="540" cy="280" r="4" />
        <circle cx="590" cy="240" r="4" />
        <circle cx="640" cy="250" r="4" />
      </g>

      <!-- Approvals line (dashed + squares) -->
      <polyline
        fill="none"
        stroke="#4c6272"
        stroke-width="3"
        stroke-dasharray="6,4"
        points="
          90,260 140,230 190,150 240,280 290,240 340,210
          390,250 440,280 490,270 540,230 590,310 640,230
        "
      />

      <!-- Approvals markers -->
      <g fill="#4c6272">
        <rect x="86" y="256" width="8" height="8" />
        <rect x="136" y="226" width="8" height="8" />
        <rect x="186" y="146" width="8" height="8" />
        <rect x="236" y="276" width="8" height="8" />
        <rect x="286" y="236" width="8" height="8" />
        <rect x="336" y="206" width="8" height="8" />
        <rect x="386" y="246" width="8" height="8" />
        <rect x="436" y="276" width="8" height="8" />
        <rect x="486" y="266" width="8" height="8" />
        <rect x="536" y="226" width="8" height="8" />
        <rect x="586" y="306" width="8" height="8" />
        <rect x="636" y="226" width="8" height="8" />
      </g>

      <!-- Direct labels -->
      <text x="500" y="180" font-size="14" fill="#005eb8">
        Applications
      </text>
      <text x="500" y="200" font-size="14" fill="#4c6272">
        Approved
      </text>
    </svg>
  </figure>

  <!-- DATA TABLE FALLBACK -->
  <table id="study-leave-chart-data">
    <caption>Study leave requests by month</caption>
    <thead>
      <tr>
        <th scope="col">Month</th>
        <th scope="col">Applications</th>
        <th scope="col">Approved</th>
      </tr>
    </thead>
    <tbody>
      <tr><th scope="row">January</th><td>40</td><td>28</td></tr>
      <tr><th scope="row">February</th><td>25</td><td>35</td></tr>
      <tr><th scope="row">March</th><td>30</td><td>55</td></tr>
      <tr><th scope="row">April</th><td>32</td><td>20</td></tr>
      <tr><th scope="row">May</th><td>40</td><td>27</td></tr>
      <tr><th scope="row">June</th><td>25</td><td>35</td></tr>
      <tr><th scope="row">July</th><td>15</td><td>25</td></tr>
      <tr><th scope="row">August</th><td>30</td><td>18</td></tr>
      <tr><th scope="row">September</th><td>22</td><td>17</td></tr>
      <tr><th scope="row">October</th><td>17</td><td>30</td></tr>
      <tr><th scope="row">November</th><td>27</td><td>10</td></tr>
      <tr><th scope="row">December</th><td>25</td><td>30</td></tr>
    </tbody>
  </table>

</section>

    </div>
  </div>
  
  <div class="nhsuk-grid-row">
  <div class="nhsuk-grid-column-one-third">
  
    <section
  aria-labelledby="category-conversion-title"
  class="dashboard-card"
  style="max-width: 360px;"
>

  <h2 id="category-conversion-title">
    Study leave overview
  </h2>

  <!-- CATEGORY BREAKDOWN (Accessible alternative to pie chart) -->
  <div aria-labelledby="category-title">
    <h3 id="category-title">Requests by category</h3>

    <ul class="category-list">
      <li>
        <span class="category-name">Courses</span>
        <span class="category-value">42%</span>
        <div
          class="bar"
          role="img"
          aria-label="Courses account for 42 percent of requests"
        >
          <span style="width: 42%"></span>
        </div>
      </li>

      <li>
        <span class="category-name">Conferences</span>
        <span class="category-value">33%</span>
        <div
          class="bar"
          role="img"
          aria-label="Conferences account for 33 percent of requests"
        >
          <span style="width: 33%"></span>
        </div>
      </li>

      <li>
        <span class="category-name">Exams</span>
        <span class="category-value">25%</span>
        <div
          class="bar"
          role="img"
          aria-label="Exams account for 25 percent of requests"
        >
          <span style="width: 25%"></span>
        </div>
      </li>
    </ul>
  </div>

  <hr />

  <!-- CONVERSION RATE -->
  <div aria-labelledby="conversion-title">
    <h3 id="conversion-title">Approval rate</h3>

    <p class="conversion-rate">
      <strong>76.5%</strong>
      <span class="trend-up" aria-label="Increase of 10 percent">
        ▲ 10%
      </span>
    </p>

    <p class="hint">
      Percentage of requests approved
    </p>
  </div>

  <hr />

  <!-- FUNNEL / STEP METRICS -->
  <div aria-labelledby="funnel-title">
    <h3 id="funnel-title">Requests</h3>

    <ol class="funnel">
      <li>
        <span>Requests submitted</span>
        <strong>5,465</strong>
      </li>
      <li>
        <span>Manager review</span>
        <strong>3,155</strong>
      </li>
      <li>
        <span>Final approval</span>
        <strong>3,044</strong>
      </li>
      <li>
        <span>Leave completed</span>
        <strong>2,891</strong>
      </li>
    </ol>
  </div>

</section>

  </div>
</div>

</div>

<style>
  .dashboard-card {
  border: 1px solid #d8dde0;
  padding: 16px;
  background: #ffffff;
}

.dashboard-card h2 {
  font-size: 1.2rem;
  margin-bottom: 1rem;
}

.dashboard-card h3 {
  font-size: 1rem;
  margin-bottom: 0.5rem;
}

.category-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.category-list li {
  margin-bottom: 0.75rem;
}

.category-name {
  display: inline-block;
}

.category-value {
  float: right;
}

.bar {
  background: #f0f4f5;
  height: 8px;
  margin-top: 4px;
}

.bar span {
  display: block;
  height: 8px;
  background: #005eb8;
}

.conversion-rate {
  font-size: 1.6rem;
  margin: 0;
}

.trend-up {
  font-size: 0.9rem;
  margin-left: 8px;
}

.funnel {
  list-style: none;
  padding: 0;
}

.funnel li {
  display: flex;
  justify-content: space-between;
  padding: 6px 0;
  border-bottom: 1px solid #e8edee;
}

</style>

       {{ button({
        text: "Download report"
       }) }}


 {% endblock %}

 